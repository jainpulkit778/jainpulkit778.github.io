<?php
session_start();

// Check if the user is logged in
if (isset($_SESSION['username'])) {
    $loggedInUsername = $_SESSION['username'];
} else {
    $loggedInUsername = 'Guest'; // Set a default if the user is not logged in
}
?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Observation Uploader</title>
</head>
<body>

    <form class="form-horizontal">
<fieldset>

<!-- Form Name -->
<legend>Observation Uploader</legend>

<!-- Text input-->
<div class="form-group">
  <label class="col-md-4 control-label" for="EurekaID">CallMiner Id</label>  
  <div class="col-md-2">
  <input id="EurekaID" name="EurekaID" type="text" placeholder="" class="form-control input-md">
  <span class="help-block">Auto populated field .If no value then close the form &amp; re-click on the Power Bi Row link.</span>  
  </div>
</div>

<!-- Text input-->
<div class="form-group">
  <label class="col-md-4 control-label" for="UserName">Logged-In User</label>  
  <div class="col-md-4">
  <input id="UserName" name="UserName" type="text" placeholder="" class="form-control input-md">
  <span class="help-block">Auto populated field </span>  
  </div>
</div>

<!-- Button Drop Down -->
<div class="form-group">
  <label class="col-md-4 control-label" for="buttondropdown">Observation Result</label>
  <div class="col-md-4">
    <div class="input-group">
      <input id="buttondropdown" name="buttondropdown" class="form-control" placeholder="Select Any One" type="text">
      <div class="input-group-btn">
        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
          
          <span class="caret"></span>
        </button>
        <ul class="dropdown-menu pull-right">
          <li><a href="#">False Positive</a></li>
          <li><a href="#">Remediation</a></li>
          <li><a href="#">Term Code Coaching</a></li>
          <li><a href="#">Spanish Call</a></li>
          <li><a href="#">Not Applicable</a></li>
        </ul>
      </div>
    </div>
  </div>
</div>

<!-- Textarea -->
<div class="form-group">
  <label class="col-md-4 control-label" for="textarea">Observation Comments</label>
  <div class="col-md-4">                     
    <textarea class="form-control" id="textarea" name="textarea"></textarea>
  </div>
</div>

<!-- Button -->
<div class="form-group">
  <label class="col-md-4 control-label" for="singlebutton"></label>
  <div class="col-md-4">
    <button id="singlebutton" name="singlebutton" class="btn btn-primary">Submit</button>
  </div>
</div>

</fieldset>
</form>

    <script>
        // Function to extract URL parameter by name
        function getURLParameter(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        // Function to set the username in the span element
        function setUsername() {
            //const usernameSpan = document.getElementById('username');
            // Replace 'getUsernameFromSystem()' with actual code to obtain the username
            const username = getUsernameFromSystem();
            usernameSpan.innerText = username;
        }

        // Function to execute upload to SharePoint
        function uploadToSharePoint() {
            // Replace the following lines with actual code to upload values to SharePoint
            const sourceVariable = document.getElementById('sourceVariable').value;
            const selectedOption = document.getElementById('options').value;
            const comments = document.getElementById('comments').value;

            // Actual upload code goes here

            // For demonstration purposes, log the values to the console
            console.log('Source Variable:', sourceVariable);
            console.log('Selected Option:', selectedOption);
            console.log('Comments:', comments);
        }

        // Initialize the form on page load
        document.addEventListener('DOMContentLoaded', function () {
            // Step 1: Extract source variable from the URL
            const sourceVariableInput = document.getElementById('sourceVariable');
            sourceVariableInput.value = getURLParameter('sourceVariable');

            // 1a: Obtain the username from the system and set it in the span element
            setUsername();
        });
    </script>

</body>
</html>
